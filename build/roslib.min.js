var ROSLIB=ROSLIB||{REVISION:"1"};ROSLIB.ActionClient=function(b){var c=this;b=b||{};this.ros=b.ros;this.serverName=b.serverName;this.actionName=b.actionName;this.timeout=b.timeout;this.goals={};var a=false;var d=new ROSLIB.Topic({ros:this.ros,name:this.serverName+"/feedback",messageType:this.actionName+"Feedback"});var e=new ROSLIB.Topic({ros:this.ros,name:this.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"});var f=new ROSLIB.Topic({ros:this.ros,name:this.serverName+"/result",messageType:this.actionName+"Result"});this.goalTopic=new ROSLIB.Topic({ros:this.ros,name:this.serverName+"/goal",messageType:this.actionName+"Goal"});this.cancelTopic=new ROSLIB.Topic({ros:this.ros,name:this.serverName+"/cancel",messageType:"actionlib_msgs/GoalID"});this.goalTopic.advertise();this.cancelTopic.advertise();e.subscribe(function(h){var g=this;a=true;h.status_list.forEach(function(i){var j=g.goals[i.goal_id.id];if(j){j.emit("status",i)}})});d.subscribe(function(h){var g=c.goals[h.status.goal_id.id];if(g){g.emit("status",h.status);g.emit("feedback",h.feedback)}});f.subscribe(function(h){var g=c.goals[h.status.goal_id.id];if(g){g.emit("status",h.status);g.emit("result",h.result)}});if(this.timeout){setTimeout(function(){if(!a){c.emit("timeout")}},this.timeout)}};ROSLIB.ActionClient.prototype.__proto__=EventEmitter2.prototype;ROSLIB.ActionClient.prototype.cancel=function(){var a=new ROSLIB.Message({});this.cancelTopic.publish(a)};ROSLIB.Goal=function(b){var c=this;this.actionClient=b.actionClient;this.goalMessage=b.goalMessage;this.isFinished=false;var a=new Date();this.goalID="goal_"+Math.random()+"_"+a.getTime();this.goalMessage=new ROSLIB.Message({goal_id:{stamp:{secs:0,nsecs:0},id:this.goalID},goal:this.goalMessage});this.on("status",function(d){c.status=d});this.on("result",function(d){c.isFinished=true;c.result=d});this.on("feedback",function(d){c.feedback=d});this.actionClient.goals[this.goalID]=this};ROSLIB.Goal.prototype.__proto__=EventEmitter2.prototype;ROSLIB.Goal.prototype.send=function(b){var a=this;a.actionClient.goalTopic.publish(a.goalMessage);if(b){setTimeout(function(){if(!a.isFinished){a.emit("timeout")}},b)}};ROSLIB.Goal.prototype.cancel=function(){var a=new ROSLIB.Message({id:this.goalID});this.actionClient.cancelTopic.publish(a)};ROSLIB.Message=function(a){var b=this;if(a){Object.keys(a).forEach(function(c){b[c]=a[c]})}};ROSLIB.Param=function(a){a=a||{};this.ros=a.ros;this.name=a.name};ROSLIB.Param.prototype.get=function(c){var b=new ROSLIB.Service({ros:this.ros,name:"/rosapi/get_param",serviceType:"rosapi/GetParam"});var a=new ROSLIB.ServiceRequest({name:this.name,value:JSON.stringify("")});b.callService(a,function(d){var e=JSON.parse(d.value);c(e)})};ROSLIB.Param.prototype.set=function(c){var b=new ROSLIB.Service({ros:this.ros,name:"/rosapi/set_param",serviceType:"rosapi/SetParam"});var a=new ROSLIB.ServiceRequest({name:this.name,value:JSON.stringify(c)});b.callService(a,function(){})};ROSLIB.Ros=function(a){this.socket=null;if(a){this.connect(a)}};ROSLIB.Ros.prototype.__proto__=EventEmitter2.prototype;ROSLIB.Ros.prototype.connect=function(c){var e=this;function b(h){e.emit("connection",h)}function a(h){e.emit("close",h)}function d(h){e.emit("error",h)}function g(h,j){var i=new Image();i.onload=function(){var k=document.createElement("canvas");var m=k.getContext("2d");k.width=i.width;k.height=i.height;m.drawImage(i,0,0);var p=m.getImageData(0,0,i.width,i.height).data;var n="";for(var l=0;l<p.length;l+=4){n+=String.fromCharCode(p[l],p[l+1],p[l+2])}var o=JSON.parse(n);j(o)};i.src="data:image/png;base64,"+h.data}function f(h){function j(k){if(k.op==="publish"){e.emit(k.topic,k.msg)}else{if(k.op==="service_response"){e.emit(k.id,k.values)}}}var i=JSON.parse(h.data);if(i.op==="png"){g(i,function(k){j(k)})}else{j(i)}}e.socket=new WebSocket(c);e.socket.onopen=b;e.socket.onclose=a;e.socket.onerror=d;e.socket.onmessage=f};ROSLIB.Ros.prototype.close=function(){if(this.socket){this.socket.close()}};ROSLIB.Ros.prototype.authenticate=function(h,b,c,e,d,g,a){var f={op:"auth",mac:h,client:b,dest:c,rand:e,t:d,level:g,end:a};callOnConnection(f)};ROSLIB.Ros.prototype.callOnConnection=function(c){var b=this;var a=JSON.stringify(c);if(ros.socket.readyState!==WebSocket.OPEN){b.once("connection",function(){b.socket.send(a)})}else{b.socket.send(a)}};ROSLIB.Ros.prototype.getTopics=function(c){var b=new ROSLIB.Service({ros:this,name:"/rosapi/topics",serviceType:"rosapi/Topics"});var a=new ROSLIB.ServiceRequest();b.callService(a,function(d){c(d.topics)})};ROSLIB.Ros.prototype.getServices=function(c){var b=new ROSLIB.Service({ros:this,name:"/rosapi/services",serviceType:"rosapi/Services"});var a=new ROSLIB.ServiceRequest();b.callService(a,function(d){c(d.services)})};ROSLIB.Ros.prototype.getParams=function(c){var a=new ROSLIB.Service({ros:this,name:"/rosapi/get_param_names",serviceType:"rosapi/GetParamNames"});var b=new ROSLIB.ServiceRequest();a.callService(b,function(d){c(d.names)})};ROSLIB.Service=function(a){a=a||{};this.ros=a.ros;this.name=a.name;this.serviceType=a.serviceType};ROSLIB.Service.prototype.callService=function(c,d){this.ros.idCounter++;serviceCallId="call_service:"+this.name+":"+this.ros.idCounter;this.ros.once(serviceCallId,function(f){var e=new ROSLIB.ServiceResponse(f);d(e)});var a=[];Object.keys(c).forEach(function(e){a.push(c[e])});var b={op:"call_service",id:serviceCallId,service:this.name,args:a};this.ros.callOnConnection(b)};ROSLIB.ServiceRequest=function(a){var b=this;if(a){Object.keys(a).forEach(function(c){b[c]=a[c]})}};ROSLIB.ServiceResponse=function(a){var b=this;if(a){Object.keys(a).forEach(function(c){b[c]=a[c]})}};ROSLIB.Topic=function(a){a=a||{};this.ros=a.ros;this.name=a.name;this.messageType=a.messageType;this.isAdvertised=false;this.compression=a.compression||"none";this.throttle_rate=a.throttle_rate||0;if(this.compression&&this.compression!=="png"&&this.compression!=="none"){this.emit("warning",this.compression+" compression is not supported. No comression will be used.")}if(this.throttle_rate<0){this.emit("warning",this.throttle_rate+" is not allowed. Set to 0");this.throttle_rate=0}};ROSLIB.Topic.prototype.__proto__=EventEmitter2.prototype;ROSLIB.Topic.prototype.subscribe=function(c){this.on("message",function(d){c(d)});this.ros.on(this.name,function(e){var d=new ROSLIB.Message(e);this.emit("message",d)});this.ros.idCounter++;var b="subscribe:"+this.name+":"+this.ros.idCounter;var a={op:"subscribe",id:b,type:this.messageType,topic:this.name,compression:this.compression,throttle_rate:this.throttle_rate};this.ros.callOnConnection(a)};ROSLIB.Topic.prototype.unsubscribe=function(){this.ros.removeAllListeners([this.name]);this.ros.idCounter++;var b="unsubscribe:"+this.name+":"+this.ros.idCounter;var a={op:"unsubscribe",id:b,topic:this.name};this.ros.callOnConnection(a)};ROSLIB.Topic.prototype.advertise=function(){this.ros.idCounter++;var a="advertise:"+this.name+":"+this.ros.idCounter;var b={op:"advertise",id:a,type:this.messageType,topic:this.name};this.ros.callOnConnection(b);this.isAdvertised=true};ROSLIB.Topic.prototype.unadvertise=function(){this.ros.idCounter++;var b="unadvertise:"+this.name+":"+this.ros.idCounter;var a={op:"unadvertise",id:b,topic:this.name};this.ros.callOnConnection(a);this.isAdvertised=false};ROSLIB.Topic.prototype.publish=function(b){if(!this.isAdvertised){this.advertise()}this.ros.idCounter++;var c="publish:"+this.name+":"+this.ros.idCounter;var a={op:"publish",id:c,topic:this.name,msg:b};this.ros.callOnConnection(a)};ROSLIB.Pose=function(a,b){this.position=new ROSLIB.Vector3();this.orientation=new ROSLIB.Quaternion();if(a!==undefined){this.position.copy(a)}if(b!==undefined){this.orientation.copy(b)}};ROSLIB.Pose.prototype.copy=function(a){this.position.copy(a.position);this.orientation.copy(a.orientation);return a};ROSLIB.Quaternion=function(a,e,d,b){var c=this;this.x=a||0;this.y=e||0;this.z=d||0;this.w=b||1};ROSLIB.Quaternion.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};ROSLIB.Quaternion.prototype.conjugate=function(){this.x*=-1;this.y*=-1;this.z*=-1;return this};ROSLIB.Quaternion.prototype.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(a===0){this.x=0;this.y=0;this.z=0;this.w=1}else{a=1/a;this.x=this.x*a;this.y=this.y*a;this.z=this.z*a;this.w=this.w*a}return this};ROSLIB.Quaternion.prototype.inverse=function(){this.conjugate().normalize();return this};ROSLIB.Quaternion.prototype.multiply=function(l,k){var i=l.x,h=l.y,g=l.z,j=l.w,e=k.x,d=k.y,c=k.z,f=k.w;this.x=i*f+h*c-g*d+j*e;this.y=-i*c+h*f+g*e+j*d;this.z=i*d-h*e+g*f+j*c;this.w=-i*e-h*d-g*c+j*f;return this};ROSLIB.Quaternion.prototype.multiplyVec3=function(c,m){if(!m){m=c}var l=c.x,k=c.y,j=c.z,h=this.x,g=this.y,f=this.z,i=this.w;var d=i*l+g*j-f*k,b=i*k+f*l-h*j,a=i*j+h*k-g*l,e=-h*l-g*k-f*j;m.x=d*i+e*-h+b*-f-a*-g;m.y=b*i+e*-g+a*-h-d*-f;m.z=a*i+e*-f+d*-g-b*-h;return m};ROSLIB.Quaternion.prototype.clone=function(){return new ROSLIB.Quaternion(this.x,this.y,this.z,this.w)};ROSLIB.Vector3=function(a,c,b){this.x=a||0;this.y=c||0;this.z=b||0};ROSLIB.Vector3.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};ROSLIB.Vector3.prototype.add=function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;this.z=d.z+c.z;return this};ROSLIB.Vector3.prototype.sub=function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;this.z=d.z-c.z;return this};ROSLIB.Vector3.prototype.clone=function(){return new ROSLIB.Vector3(this.x,this.y,this.z)};ROSLIB.TFClient=function(a){var a=a||{};this.ros=a.ros;this.fixedFrame=a.fixedFrame||"/base_link";this.angularThres=a.angularThres||2;this.transThres=a.transThres||0.01;this.rate=a.rate||10;this.goalUpdateDelay=a.goalUpdateDelay||50;this.currentGoal=false;this.frameInfos={};this.goalUpdateRequested=false;this.actionClient=new ROSLIB.ActionClient({ros:this.ros,serverName:"/tf2_web_republisher",actionName:"tf2_web_republisher/TFSubscriptionAction"})};ROSLIB.TFClient.prototype.processFeedback=function(b){var a=this;b.transforms.forEach(function(c){var d=c.child_frame_id;var e=a.frameInfos[d];if(e!=undefined){e.transform=new ROSLIB.Transform(c.transform.translation,c.transform.rotation);e.cbs.forEach(function(f){f(e.transform)})}})};ROSLIB.TFClient.prototype.updateGoal=function(){if(this.currentGoal){this.currentGoal.cancel()}var a={source_frames:[],target_frame:this.fixedFrame,angular_thres:this.angularThres,trans_thres:this.transThres,rate:this.rate};for(frame in this.frameInfos){a.source_frames.push(frame)}this.currentGoal=new ROSLIB.Goal({actionClient:this.actionClient,goalMessage:a});this.currentGoal.on("feedback",this.processFeedback.bind(this));this.currentGoal.send();this.goalUpdateRequested=false};ROSLIB.TFClient.prototype.subscribe=function(a,b){if(a[0]==="/"){a=a.substring(1)}if(this.frameInfos[a]==undefined){this.frameInfos[a]={cbs:[]};if(!this.goalUpdateRequested){setTimeout(this.updateGoal.bind(tfClient),this.goalUpdateDelay);this.goalUpdateRequested=true}}else{if(this.frameInfos[a].transform!=undefined){b(this.frameInfos[a].transform)}}this.frameInfos[a].cbs.push(b)};ROSLIB.TFClient.prototype.unsubscribe=function(a,d){var c=this.frameInfos[a];if(c!=undefined){var b=c.cbs.indexOf(d);if(b>=0){c.cbs.splice(b,1);if(c.cbs.length==0){delete this.frameInfos[a]}this.needUpdate=true}}};ROSLIB.Transform=function(b,a){this.translation=new ROSLIB.Vector3();this.rotation=new ROSLIB.Quaternion();if(b!==undefined){this.translation.copy(b)}if(a!==undefined){this.rotation.copy(a)}};ROSLIB.Transform.prototype.apply=function(a){this.rotation.multiplyVec3(a.position);a.position.add(a.position,this.translation);a.orientation.multiply(this.rotation,a.orientation);return a};ROSLIB.Transform.prototype.applyInverse=function(b){var a=this.rotation.clone().inverse();a.multiplyVec3(b.position);b.position.sub(b.position,this.translation);b.orientation.multiply(a,b.orientation);return b};ROSLIB.Transform.prototype.copy=function(a){a.translation.copy(a.translation);a.rotation.copy(a.rotation);return a};