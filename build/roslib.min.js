var ROSLIB=ROSLIB||{REVISION:"1"};ROSLIB.ActionClient=function(b){var d=this;b=b||{};this.ros=b.ros;this.serverName=b.serverName;this.actionName=b.actionName;this.timeout=b.timeout;this.goals={};var a=false;var c=new ROSLIB.Topic({ros:this.ros,name:this.serverName+"/feedback",messageType:this.actionName+"Feedback"});var e=new ROSLIB.Topic({ros:this.ros,name:this.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"});var f=new ROSLIB.Topic({ros:this.ros,name:this.serverName+"/result",messageType:this.actionName+"Result"});this.goalTopic=new ROSLIB.Topic({ros:this.ros,name:this.serverName+"/goal",messageType:this.actionName+"Goal"});this.cancelTopic=new ROSLIB.Topic({ros:this.ros,name:this.serverName+"/cancel",messageType:"actionlib_msgs/GoalID"});this.cancel=function(){var g=new ROSLIB.Message({});this.cancelTopic.publish(g)};this.goalTopic.advertise();this.cancelTopic.advertise();e.subscribe(function(g){a=true;g.status_list.forEach(function(h){var i=d.goals[h.goal_id.id];if(i){i.emit("status",h)}})});c.subscribe(function(h){var g=d.goals[h.status.goal_id.id];if(g){g.emit("status",h.status);g.emit("feedback",h.feedback)}});f.subscribe(function(h){var g=d.goals[h.status.goal_id.id];if(g){g.emit("status",h.status);g.emit("result",h.result)}});if(this.timeout){setTimeout(function(){if(!a){d.emit("timeout")}},this.timeout)}};ROSLIB.ActionClient.prototype.__proto__=EventEmitter2.prototype;ROSLIB.Goal=function(c){var b=this;this.actionClient=c.actionClient;this.goalMessage=c.goalMessage;this.isFinished=false;var a=new Date();this.send=function(d){b.actionClient.goalTopic.publish(b.goalMessage);if(d){setTimeout(function(){if(!b.isFinished){b.emit("timeout")}},d)}};this.cancel=function(){var d=new ROSLIB.Message({id:b.goalID});b.actionClient.cancelTopic.publish(d)};this.goalID="goal_"+Math.random()+"_"+a.getTime();this.goalMessage=new ROSLIB.Message({goal_id:{stamp:{secs:0,nsecs:0},id:this.goalID},goal:this.goalMessage});this.on("status",function(d){this.status=d});this.on("result",function(d){this.isFinished=true;this.result=d});this.on("feedback",function(d){this.feedback=d});this.actionClient.goals[this.goalID]=this};ROSLIB.Goal.prototype.__proto__=EventEmitter2.prototype;ROSLIB.Message=function(a){var b=this;if(a){Object.keys(a).forEach(function(c){b[c]=a[c]})}};ROSLIB.Param=function(a){var b=this;a=a||{};this.ros=a.ros;this.name=a.name;this.get=function(e){var d=new ROSLIB.Service({ros:b.ros,name:"/rosapi/get_param",serviceType:"rosapi/GetParam"});var c=new ROSLIB.ServiceRequest({name:b.name,value:JSON.stringify("")});d.callService(c,function(f){var g=JSON.parse(f.value);e(g)})};this.set=function(e){var d=new ROSLIB.Service({ros:b.ros,name:"/rosapi/set_param",serviceType:"rosapi/SetParam"});var c=new ROSLIB.ServiceRequest({name:b.name,value:JSON.stringify(e)});d.callService(c,function(){})}};ROSLIB.Ros=function(d){var c=this;this.socket=null;function b(h){c.emit("connection",h)}function a(h){c.emit("close",h)}function e(h){c.emit("error",h)}function g(h,j){var i=new Image();i.onload=function(){var k=document.createElement("canvas");var m=k.getContext("2d");k.width=i.width;k.height=i.height;m.drawImage(i,0,0);var p=m.getImageData(0,0,i.width,i.height).data;var n="";for(var l=0;l<p.length;l+=4){n+=String.fromCharCode(p[l],p[l+1],p[l+2])}var o=JSON.parse(n);j(o)};i.src="data:image/png;base64,"+h.data}function f(h){function j(k){if(k.op==="publish"){c.emit(k.topic,k.msg)}else{if(k.op==="service_response"){c.emit(k.id,k.values)}}}var i=JSON.parse(h.data);if(i.op==="png"){g(i,function(k){j(k)})}else{j(i)}}this.connect=function(h){c.socket=new WebSocket(h);c.socket.onopen=b;c.socket.onclose=a;c.socket.onerror=e;c.socket.onmessage=f};this.close=function(){if(c.socket){c.socket.close()}};this.authenticate=function(o,i,j,l,k,n,h){var m={op:"auth",mac:o,client:i,dest:j,rand:l,t:k,level:n,end:h};callOnConnection(m)};this.callOnConnection=function(i){var h=JSON.stringify(i);if(c.socket.readyState!==WebSocket.OPEN){c.once("connection",function(){c.socket.send(h)})}else{c.socket.send(h)}};this.getTopics=function(j){var i=new ROSLIB.Service({ros:c,name:"/rosapi/topics",serviceType:"rosapi/Topics"});var h=new ROSLIB.ServiceRequest();i.callService(h,function(k){j(k.topics)})};this.getServices=function(j){var i=new ROSLIB.Service({ros:c,name:"/rosapi/services",serviceType:"rosapi/Services"});var h=new ROSLIB.ServiceRequest();i.callService(h,function(k){j(k.services)})};this.getParams=function(j){var h=new ROSLIB.Service({ros:c,name:"/rosapi/get_param_names",serviceType:"rosapi/GetParamNames"});var i=new ROSLIB.ServiceRequest();h.callService(i,function(k){j(k.names)})};if(d){this.connect(d)}};ROSLIB.Ros.prototype.__proto__=EventEmitter2.prototype;ROSLIB.Service=function(b){var a=this;b=b||{};this.ros=b.ros;this.name=b.name;this.serviceType=b.serviceType;this.callService=function(e,f){a.ros.idCounter++;serviceCallId="call_service:"+a.name+":"+a.ros.idCounter;a.ros.once(serviceCallId,function(h){var g=new ROSLIB.ServiceResponse(h);f(g)});var c=[];Object.keys(e).forEach(function(g){c.push(e[g])});var d={op:"call_service",id:serviceCallId,service:a.name,args:c};a.ros.callOnConnection(d)}};ROSLIB.ServiceRequest=function(a){var b=this;if(a){Object.keys(a).forEach(function(c){b[c]=a[c]})}};ROSLIB.ServiceResponse=function(b){var a=this;if(b){Object.keys(b).forEach(function(c){a[c]=b[c]})}};ROSLIB.Topic=function(b){var a=this;b=b||{};this.ros=b.ros;this.name=b.name;this.messageType=b.messageType;this.isAdvertised=false;this.compression=b.compression||"none";this.throttle_rate=b.throttle_rate||0;if(this.compression&&this.compression!=="png"&&this.compression!=="none"){this.emit("warning",this.compression+" compression is not supported. No comression will be used.")}if(this.throttle_rate<0){this.emit("warning",this.throttle_rate+" is not allowed. Set to 0");this.throttle_rate=0}this.subscribe=function(e){a.on("message",function(f){e(f)});a.ros.on(a.name,function(g){var f=new ROSLIB.Message(g);a.emit("message",f)});a.ros.idCounter++;var d="subscribe:"+a.name+":"+a.ros.idCounter;var c={op:"subscribe",id:d,type:a.messageType,topic:a.name,compression:a.compression,throttle_rate:a.throttle_rate};a.ros.callOnConnection(c)};this.unsubscribe=function(){a.ros.removeAllListeners([a.name]);a.ros.idCounter++;var d="unsubscribe:"+a.name+":"+a.ros.idCounter;var c={op:"unsubscribe",id:d,topic:a.name};a.ros.callOnConnection(c)};this.advertise=function(){a.ros.idCounter++;var c="advertise:"+a.name+":"+a.ros.idCounter;var d={op:"advertise",id:c,type:a.messageType,topic:a.name};a.ros.callOnConnection(d);a.isAdvertised=true};this.unadvertise=function(){a.ros.idCounter++;var d="unadvertise:"+a.name+":"+a.ros.idCounter;var c={op:"unadvertise",id:d,topic:a.name};a.ros.callOnConnection(c);a.isAdvertised=false};this.publish=function(d){if(!a.isAdvertised){a.advertise()}a.ros.idCounter++;var e="publish:"+a.name+":"+a.ros.idCounter;var c={op:"publish",id:e,topic:a.name,msg:d};a.ros.callOnConnection(c)}};ROSLIB.Topic.prototype.__proto__=EventEmitter2.prototype;ROSLIB.Pose=function(a,b){var c=this;this.position=new ROSLIB.Vector3();this.orientation=new ROSLIB.Quaternion();if(a!==undefined){this.position.copy(a)}if(b!==undefined){this.orientation.copy(b)}this.copy=function(d){d.position.copy(d.position);d.orientation.copy(d.orientation);return d}};ROSLIB.Quaternion=function(a,e,d,b){var c=this;this.x=a||0;this.y=e||0;this.z=d||0;this.w=b||1;this.copy=function(f){c.x=f.x;c.y=f.y;c.z=f.z;c.w=f.w;return c};this.conjugate=function(){c.x*=-1;c.y*=-1;c.z*=-1;return c};this.normalize=function(){var f=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z+c.w*c.w);if(f===0){c.x=0;c.y=0;c.z=0;c.w=1}else{f=1/f;c.x=c.x*f;c.y=c.y*f;c.z=c.z*f;c.w=c.w*f}return c};this.inverse=function(){this.conjugate().normalize();return c};this.multiply=function(o,n){var l=o.x,k=o.y,j=o.z,m=o.w,h=n.x,g=n.y,f=n.z,i=n.w;this.x=l*i+k*f-j*g+m*h;this.y=-l*f+k*i+j*h+m*g;this.z=l*g-k*h+j*i+m*f;this.w=-l*h-k*g-j*f+m*i;return c};this.multiplyVec3=function(h,r){if(!r){r=h}var q=h.x,p=h.y,o=h.z,m=c.x,l=c.y,k=c.z,n=c.w;var i=n*q+l*o-k*p,g=n*p+k*q-m*o,f=n*o+m*p-l*q,j=-m*q-l*p-k*o;r.x=i*n+j*-m+g*-k-f*-l;r.y=g*n+j*-l+f*-m-i*-k;r.z=f*n+j*-k+i*-l-g*-m;return r};this.clone=function(){return new ROSLIB.Quaternion(c.x,c.y,c.z,c.w)}};ROSLIB.Vector3=function(a,d,c){var b=this;this.x=a||0;this.y=d||0;this.z=c||0;this.copy=function(e){b.x=e.x;b.y=e.y;b.z=e.z;return b};this.add=function(f,e){b.x=f.x+e.x;b.y=f.y+e.y;b.z=f.z+e.z;return b};this.sub=function(f,e){b.x=f.x-e.x;b.y=f.y-e.y;b.z=f.z-e.z;return b};this.clone=function(){return new ROSLIB.Vector3(b.x,b.y,b.z)}};ROSLIB.TFClient=function(b){var a=this;var b=b||{};this.ros=b.ros;this.fixedFrame=b.fixedFrame||"/base_link";this.angularThres=b.angularThres||2;this.transThres=b.transThres||0.01;this.rate=b.rate||10;this.goalUpdateDelay=b.goalUpdateDelay||50;this.currentGoal=false;this.frameInfos={};this.goalUpdateRequested=false;this.actionClient=new ROSLIB.ActionClient({ros:this.ros,serverName:"/tf2_web_republisher",actionName:"tf2_web_republisher/TFSubscriptionAction"});this.processFeedback=function(c){c.transforms.forEach(function(d){var e=d.child_frame_id;var f=a.frameInfos[e];if(f!=undefined){f.transform=new ROSLIB.Transform(d.transform.translation,d.transform.rotation);f.cbs.forEach(function(g){g(f.transform)})}})};this.updateGoal=function(){if(a.currentGoal){a.currentGoal.cancel()}var c={source_frames:[],target_frame:a.fixedFrame,angular_thres:a.angularThres,trans_thres:a.transThres,rate:a.rate};for(frame in a.frameInfos){c.source_frames.push(frame)}a.currentGoal=new ROSLIB.Goal({actionClient:a.actionClient,goalMessage:c});a.currentGoal.on("feedback",a.processFeedback.bind(a));a.currentGoal.send();a.goalUpdateRequested=false};this.subscribe=function(c,d){if(c[0]==="/"){c=c.substring(1)}if(a.frameInfos[c]==undefined){a.frameInfos[c]={cbs:[]};if(!a.goalUpdateRequested){setTimeout(a.updateGoal.bind(a),a.goalUpdateDelay);a.goalUpdateRequested=true}}else{if(a.frameInfos[c].transform!=undefined){d(a.frameInfos[c].transform)}}a.frameInfos[c].cbs.push(d)};this.unsubscribe=function(c,f){var e=a.frameInfos[c];if(e!=undefined){var d=e.cbs.indexOf(f);if(d>=0){e.cbs.splice(d,1);if(e.cbs.length==0){delete a.frameInfos[c]}a.needUpdate=true}}}};ROSLIB.Transform=function(c,b){var a=this;this.translation=new ROSLIB.Vector3();this.rotation=new ROSLIB.Quaternion();if(c!==undefined){this.translation.copy(c)}if(b!==undefined){this.rotation.copy(b)}this.apply=function(d){a.rotation.multiplyVec3(d.position);d.position.add(d.position,a.translation);d.orientation.multiply(a.rotation,d.orientation);return d};this.applyInverse=function(e){var d=a.rotation.clone().inverse();d.multiplyVec3(e.position);e.position.sub(e.position,a.translation);e.orientation.multiply(d,e.orientation);return e};this.copy=function(d){d.translation.copy(d.translation);d.rotation.copy(d.rotation);return d}};