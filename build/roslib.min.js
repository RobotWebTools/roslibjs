var ROSLIB=ROSLIB||{REVISION:"1"};(function(a,b){if(typeof define==="function"&&define.amd){define(["eventemitter2"],b)}else{a.ActionClient=b(a.EventEmitter2)}}(this,function(a){var b=function(d){var f=this;d=d||{};f.ros=d.ros;f.serverName=d.serverName;f.actionName=d.actionName;f.timeout=d.timeout;f.goals={};f.goalTopic=new f.ros.Topic({name:f.serverName+"/goal",messageType:f.actionName+"Goal"});f.goalTopic.advertise();f.cancelTopic=new f.ros.Topic({name:f.serverName+"/cancel",messageType:"actionlib_msgs/GoalID"});f.cancelTopic.advertise();var c=false;var g=new f.ros.Topic({name:f.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"});g.subscribe(function(i){c=true;i.status_list.forEach(function(j){var k=f.goals[j.goal_id.id];if(k){k.emit("status",j)}})});if(f.timeout){setTimeout(function(){if(!c){f.emit("timeout")}},f.timeout)}var e=new f.ros.Topic({name:f.serverName+"/feedback",messageType:f.actionName+"Feedback"});e.subscribe(function(j){var i=f.goals[j.status.goal_id.id];if(i){i.emit("status",j.status);i.emit("feedback",j.feedback)}});var h=new f.ros.Topic({name:f.serverName+"/result",messageType:f.actionName+"Result"});h.subscribe(function(j){var i=f.goals[j.status.goal_id.id];if(i){i.emit("status",j.status);i.emit("result",j.result)}});f.cancel=function(){var i=new f.ros.Message({});f.cancelTopic.publish(i)};f.Goal=function(k){var j=this;j.isFinished=false;j.status;j.result;j.feedback;var i=new Date();j.goalId="goal_"+Math.random()+"_"+i.getTime();j.goalMessage=new f.ros.Message({goal_id:{stamp:{secs:0,nsecs:0},id:j.goalId},goal:k});j.on("status",function(l){j.status=l});j.on("result",function(l){j.isFinished=true;j.result=l});j.on("feedback",function(l){j.feedback=l});f.goals[j.goalId]=this;j.send=function(l){f.goalTopic.publish(j.goalMessage);if(l){setTimeout(function(){if(!j.isFinished){j.emit("timeout")}},l)}};j.cancel=function(){var l=new f.ros.Message({id:j.goalId});f.cancelTopic.publish(l)}};f.Goal.prototype.__proto__=a.prototype};b.prototype.__proto__=a.prototype;return b}));ROSLIB.Message=function(a){var b=this;if(a){Object.keys(a).forEach(function(c){b[c]=a[c]})}};ROSLIB.Param=function(a){var b=this;a=a||{};b.name=a.name;b.get=function(e){var d=new ROSLIB.Service({name:"/rosapi/get_param",serviceType:"rosapi/GetParam"});var c=new ROSLIB.ServiceRequest({name:b.name,value:JSON.stringify("")});d.callService(c,function(f){var g=JSON.parse(f.value);e(g)})};b.set=function(e){var d=new ROSLIB.Service({name:"/rosapi/set_param",serviceType:"rosapi/SetParam"});var c=new ROSLIB.ServiceRequest({name:b.name,value:JSON.stringify(e)});d.callService(c,function(){})}};ROSLIB.Param.prototype.__proto__=EventEmitter2.prototype;ROSLIB.Ros=function(d){var c=this;c.socket=null;function b(h){c.emit("connection",h)}function a(h){c.emit("close",h)}function e(h){c.emit("error",h)}function g(h,j){var i=new Image();i.onload=function(){var k=document.createElement("canvas");var m=k.getContext("2d");k.width=i.width;k.height=i.height;m.drawImage(i,0,0);var p=m.getImageData(0,0,i.width,i.height).data;var n="";for(var l=0;l<p.length;l+=4){n+=String.fromCharCode(p[l],p[l+1],p[l+2])}var o=JSON.parse(n);j(o)};i.src="data:image/png;base64,"+h.data}function f(h){function j(k){if(k.op==="publish"){c.emit(k.topic,k.msg)}else{if(k.op==="service_response"){c.emit(k.id,k.values)}}}var i=JSON.parse(h.data);if(i.op==="png"){g(i,function(k){j(k)})}else{j(i)}}c.connect=function(h){c.socket=new WebSocket(h);c.socket.onopen=b;c.socket.onclose=a;c.socket.onerror=e;c.socket.onmessage=f};c.close=function(){if(c.socket){c.socket.close()}};c.authenticate=function(o,i,j,l,k,n,h){var m={op:"auth",mac:o,client:i,dest:j,rand:l,t:k,level:n,end:h};callOnConnection(m)};c.callOnConnection=function(i){var h=JSON.stringify(i);if(c.socket.readyState!==WebSocket.OPEN){c.once("connection",function(){c.socket.send(h)})}else{c.socket.send(h)}};c.getTopics=function(j){var i=new ROSLIB.Service({name:"/rosapi/topics",serviceType:"rosapi/Topics"});var h=new ROSLIB.ServiceRequest();i.callService(h,function(k){j(k.topics)})};c.getServices=function(j){var i=new ROSLIB.Service({name:"/rosapi/services",serviceType:"rosapi/Services"});var h=new ROSLIB.ServiceRequest();i.callService(h,function(k){j(k.services)})};c.getParams=function(j){var h=new ROSLIB.Service({name:"/rosapi/get_param_names",serviceType:"rosapi/GetParamNames"});var i=new ROSLIB.ServiceRequest();h.callService(i,function(k){j(k.names)})};if(d){c.connect(d)}};ROSLIB.Ros.prototype.__proto__=EventEmitter2.prototype;ROSLIB.Service=function(b){var a=this;b=b||{};a.ros=b.ros;a.name=b.name;a.serviceType=b.serviceType;a.callService=function(e,f){ros.idCounter++;serviceCallId="call_service:"+a.name+":"+ros.idCounter;ros.once(serviceCallId,function(h){var g=new ROSLIB.ServiceResponse(h);f(g)});var c=[];Object.keys(e).forEach(function(g){c.push(e[g])});var d={op:"call_service",id:serviceCallId,service:a.name,args:c};ros.callOnConnection(d)}};ROSLIB.Service.prototype.__proto__=EventEmitter2.prototype;ROSLIB.ServiceRequest=function(a){var b=this;if(a){Object.keys(a).forEach(function(c){b[c]=a[c]})}};ROSLIB.ServiceResponse=function(b){var a=this;if(b){Object.keys(b).forEach(function(c){a[c]=b[c]})}};ROSLIB.Topic=function(b){var a=this;b=b||{};a.ros=b.ros;a.name=b.name;a.messageType=b.messageType;a.isAdvertised=false;a.compression=b.compression||"none";a.throttle_rate=b.throttle_rate||0;if(a.compression&&a.compression!=="png"&&a.compression!=="none"){a.emit("warning",a.compression+" compression is not supported. No comression will be used.")}if(a.throttle_rate<0){a.emit("warning",a.throttle_rate+" is not allowed. Set to 0");a.throttle_rate=0}a.subscribe=function(e){a.on("message",function(f){e(f)});ros.on(a.name,function(g){var f=new ROSLIB.Message(g);a.emit("message",f)});ros.idCounter++;var d="subscribe:"+a.name+":"+ros.idCounter;var c={op:"subscribe",id:d,type:a.messageType,topic:a.name,compression:a.compression,throttle_rate:a.throttle_rate};ros.callOnConnection(c)};a.unsubscribe=function(){ros.removeAllListeners([a.name]);ros.idCounter++;var d="unsubscribe:"+a.name+":"+ros.idCounter;var c={op:"unsubscribe",id:d,topic:a.name};ros.callOnConnection(c)};a.advertise=function(){ros.idCounter++;var c="advertise:"+a.name+":"+ros.idCounter;var d={op:"advertise",id:c,type:a.messageType,topic:a.name};ros.callOnConnection(d);a.isAdvertised=true};a.unadvertise=function(){ros.idCounter++;var d="unadvertise:"+a.name+":"+ros.idCounter;var c={op:"unadvertise",id:d,topic:a.name};ros.callOnConnection(c);a.isAdvertised=false};a.publish=function(d){if(!a.isAdvertised){a.advertise()}ros.idCounter++;var e="publish:"+a.name+":"+ros.idCounter;var c={op:"publish",id:e,topic:a.name,msg:d};ros.callOnConnection(c)}};ROSLIB.Topic.prototype.__proto__=EventEmitter2.prototype;(function(a,b){if(typeof define==="function"&&define.amd){define(["robotwebtools/eventemitter2","robotwebtools/actionclient"],b)}else{a.TfClient=b(a.EventEmitter2,a.ActionClient)}}(this,function(b,g){var d=function(h){this.ros=h.ros;this.fixedFrame=h.fixedFrame||"base_link";this.angularThres=h.angularThres||2;this.transThres=h.transThres||0.01;this.rate=h.rate||10;this.goalUpdateDelay=h.goalUpdateDelay!==undefined?h.goalUpdateDelay:50;var h={ros:this.ros,serverName:h.serverName||"/tf2_web_republisher",actionName:"tf2_web_republisher/TFSubscriptionAction"};this.actionClient=new g(h);this.currentGoal=false;this.frame_infos={};this.goalUpdateRequested=false};d.prototype.__proto__=b.prototype;d.prototype.processFeedback=function(i){var h=this;i.transforms.forEach(function(j){var k=j.child_frame_id;var l=h.frame_infos[k];if(l!=undefined){l.transform=new c(j.transform.translation,j.transform.rotation);l.cbs.forEach(function(m){m(l.transform)})}})};d.prototype.requestGoalUpdate=function(){if(!this.goalUpdateRequested){setTimeout(this.updateGoal.bind(this),this.goalUpdateDelay);this.goalUpdateRequested=true;return}};d.prototype.updateGoal=function(){if(this.currentGoal){this.currentGoal.cancel()}var i={source_frames:[],target_frame:this.fixedFrame,angular_thres:this.angularThres,trans_thres:this.transThres,rate:this.rate};var h=[];for(frame in this.frame_infos){i.source_frames.push(frame)}this.currentGoal=new this.actionClient.Goal(i);this.currentGoal.on("feedback",this.processFeedback.bind(this));this.currentGoal.send();this.goalUpdateRequested=false};d.prototype.subscribe=function(h,i){if(h[0]==="/"){h=h.substring(1)}if(this.frame_infos[h]==undefined){this.frame_infos[h]={cbs:[]};this.requestGoalUpdate()}else{if(this.frame_infos[h].transform!=undefined){i(this.frame_infos[h].transform)}}this.frame_infos[h].cbs.push(i)};d.prototype.unsubscribe=function(i,k){var j=this.frame_infos[i];if(j!=undefined){var h=j.cbs.indexOf(k);if(h>=0){j.cbs.splice(h,1);if(j.cbs.length==0){delete this.frame_infos[i]}this.needUpdate=true}}};var f=d.Pose=function(h,i){this.position=new a;this.orientation=new e;if(h!==undefined){this.position.copy(h)}if(i!==undefined){this.orientation.copy(i)}};f.prototype={constructor:f,copy:function(h){this.position.copy(h.position);this.orientation.copy(h.orientation)}};var c=d.Transform=function(i,h){this.translation=new a;this.rotation=new e;if(i!==undefined){this.translation.copy(i)}if(h!==undefined){this.rotation.copy(h)}};c.prototype={constructor:c,apply:function(h){this.rotation.multiplyVec3(h.position);h.position.add(h.position,this.translation);h.orientation.multiply(this.rotation,h.orientation);return h},applyInverse:function(i){var h=this.rotation.clone().inverse();h.multiplyVec3(i.position);i.position.sub(i.position,this.translation);i.orientation.multiply(h,i.orientation);return i},copy:function(h){this.translation.copy(h.translation);this.rotation.copy(h.rotation)}};var e=d.Quaternion=function(h,k,j,i){this.x=h||0;this.y=k||0;this.z=j||0;this.w=(i!==undefined)?i:1};e.prototype={constructor:e,copy:function(h){this.x=h.x;this.y=h.y;this.z=h.z;this.w=h.w;return this},inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},normalize:function(){var h=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(h===0){this.x=0;this.y=0;this.z=0;this.w=1}else{h=1/h;this.x=this.x*h;this.y=this.y*h;this.z=this.z*h;this.w=this.w*h}return this},multiply:function(q,p){var n=q.x,m=q.y,l=q.z,o=q.w,j=p.x,i=p.y,h=p.z,k=p.w;this.x=n*k+m*h-l*i+o*j;this.y=-n*h+m*k+l*j+o*i;this.z=n*i-m*j+l*k+o*h;this.w=-n*j-m*i-l*h+o*k;return this},multiplyVec3:function(j,t){if(!t){t=j}var s=j.x,r=j.y,q=j.z,o=this.x,n=this.y,m=this.z,p=this.w;var k=p*s+n*q-m*r,i=p*r+m*s-o*q,h=p*q+o*r-n*s,l=-o*s-n*r-m*q;t.x=k*p+l*-o+i*-m-h*-n;t.y=i*p+l*-n+h*-o-k*-m;t.z=h*p+l*-m+k*-n-i*-o;return t},clone:function(){return new e(this.x,this.y,this.z,this.w)}};var a=d.Vector3=function(h,j,i){this.x=h||0;this.y=j||0;this.z=i||0};a.prototype={constructor:a,copy:function(h){this.x=h.x;this.y=h.y;this.z=h.z;return this},add:function(i,h){this.x=i.x+h.x;this.y=i.y+h.y;this.z=i.z+h.z;return this},sub:function(i,h){this.x=i.x-h.x;this.y=i.y-h.y;this.z=i.z-h.z;return this},clone:function(){return new a(this.x,this.y,this.z)}};return d}));